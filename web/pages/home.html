<!--
 * @Descripttion: 
 * @Author: sjq
 * @Date: 2020-05-30 15:44:17
 * @LastEditors: sjq
 * @LastEditTime: 2020-06-02 18:10:00
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>home</title>
    <script src="/web/js/utils.js"></script>
    <script src="/web/js/ajax.js"></script>
    <script>
      let username = getCookie("username");
      if (!username) {
        window.location.href = "/";
      }
    </script>
    <style>
      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
      }
      .table {
        border: solid 1px #000;
        border-bottom: none;
        width: 1212px;
      }
      .table .list {
        height: 50px;
        border-bottom: 1px solid #000;
      }
      .table .list .item {
        width: 200px;
        line-height: 50px;
        padding-left: 10px;
        border-right: 1px solid #000;
        display: inline-block;
      }
      .table .list .item:last-child {
        border-right: none;
      }
    </style>
  </head>
  <body>
    <h1>首页</h1>
    <h2>用户名：<span id="userName"></span></h2>
    <button onclick="logout()">注销</button>
    <div class="table"></div>
    <script type="text/javascript">
      let table = document.querySelector(".table");
      console.log(table);
      let arr = {
        username: "用户名",
        password: "密码",
        sexValue: "性别",
        userEmail: "邮箱",
        userBasicInfo: "基本信息",
        fn: "操作",
      };
      let obj = [
        "username",
        "password",
        "sexValue",
        "userEmail",
        "userBasicInfo",
        "fn",
      ];
      let list = [];
      creatList(arr);
      getuserlist();
      userName.innerHTML = username;
      function logout() {
        deleteCookie("username");
        deleteCookie("password");
        window.location.href = "/";
      }
      // 点击删除
      function deleteuser(id) {
        ajax("/user/deleteuser", { id }, "post").then((res) => {
          let data = JSON.parse(res);
          if (data.code == 1) {
            list.splice(
              list.findIndex((item) => item.id == id),
              1
            );
            console.log(list);
            table.innerHTML = "";
            creatList(arr);
            for (var i = 0; i < list.length; i++) {
              creatList(list[i]);
            }
            alert(data.message);
          } else {
            alert(data.message);
          }
        });
      }
      // 获取用户列表
      function getuserlist() {
        ajax("/user/userlist", { name: username }, "POST").then((res) => {
          let data = JSON.parse(res);
          if (data.code == 1) {
            list = data.result;
            for (var i = 0; i < list.length; i++) {
              creatList(list[i]);
            }
          } else {
            alert(data.message);
          }
        });
      }
      // 编辑用户
      function edit(id) {
        window.location.href = "/web/pages/edit.html?id=" + id;
      }
      // 创建表格
      function creatList(data) {
        let list = document.createElement("div");
        list.classList.add("list");
        for (var i = 0; i < obj.length; i++) {
          let item = document.createElement("span");
          item.classList.add("item");
          if (i == obj.length - 1 && !data[obj[i]]) {
            item.innerHTML = `<button class="del" index=${data.id} onclick="deleteuser(${data.id})">删除</button>&nbsp;&nbsp;&nbsp;<button class="edit" index=${data.id} onclick="edit(${data.id})">编辑</button>`;
          } else {
            item.innerHTML = data[obj[i]];
          }
          list.appendChild(item);
        }
        table.appendChild(list);
      }
    </script>
  </body>
</html>
